<HTML>
<HEAD>
<TITLE>
BeanWrapperMacro.h
</TITLE>
</HEAD>
<BODY>
<PRE>
<font color="green">/*
* Copyright 2006 the original author or authors.
* 
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* 
*      http://www.apache.org/licenses/LICENSE-2.0
* 
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/</font>

<font color="blue">#ifndef</font> AUTUMN_WRAPPERMACRO_H
<font color="blue">#define</font> AUTUMN_WRAPPERMACRO_H

<font color="blue">#include</font> <font color="maroon">"IBeanWrapper.h"</font>
<font color="blue">#include</font> <font color="maroon">&#60;iostream&#62;</font>

<font color="blue">#ifdef</font> WIN32
    <font color="blue">#ifdef</font> _USRDLL
        <font color="blue">#define</font> DLL_EXPORT _declspec<font color="black">(</font>dllexport<font color="black">)</font>
    <font color="blue">#else</font>
        <font color="blue">#define</font> DLL_EXPORT 
    <font color="blue">#endif</font>
<font color="blue">#else</font>
    <font color="blue">#define</font> DLL_EXPORT
<font color="blue">#endif</font>

<font color="blue">using</font> <font color="blue">namespace</font> std;

<font color="green">/** Define a bean's adapter */</font>
<font color="green">/** 
 * Define bean adapter's first part 
 * the constructor of adapter
 * the function to release bean
 * @param bean The bean name, it is user's class name
 */</font>
<font color="blue">#define</font> AUTUMNBEAN<font color="black">(</font>bean<font color="black">)</font>                                            \
<font color="blue">class</font> bean##_Wrapper<font color="black">:</font><font color="blue">public</font> IBeanWrapper<font color="black">{</font>                           \
    bean <font color="black">*</font> pBean;                                                   \
                                                                    \
<font color="blue">public</font><font color="black">:</font>                                                             \
    bean##_Wrapper<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                               \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>setBeanName<font color="black">(</font>#bean<font color="black">)</font>;                                   \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean <font color="black">=</font> NULL;                                         \
    <font color="black">}</font>                                                               \
                                                                    \
    ~##bean##_Wrapper<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                            \
        <font color="blue">if</font><font color="black">(</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean <font color="black">)</font> <font color="black">{</font>                                         \
            <font color="blue">if</font><font color="black">(</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>getDestroyable<font color="black">(</font><font color="black">)</font> <font color="black">)</font> <font color="black">{</font>                          \
                <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>destroyBean<font color="black">(</font><font color="black">)</font>;                                \
            <font color="black">}</font>                                                       \
            <font color="blue">delete</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean;                                     \
        <font color="black">}</font>                                                           \
    <font color="black">}</font>                                                               \
                                                                    \
    <font color="blue">void</font><font color="black">*</font> getBean<font color="black">(</font><font color="black">)</font><font color="black">{</font> <font color="blue">return</font> <font color="black">(</font><font color="blue">void</font><font color="black">*</font><font color="black">)</font><font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean; <font color="black">}</font>                   \
                                                                    \
    string trimString<font color="black">(</font><font color="blue">const</font> string v<font color="black">)</font><font color="black">{</font>                              \
        string s<font color="black">=</font>v;                                                 \
        <font color="blue">for</font><font color="black">(</font><font color="blue">int</font> i<font color="black">=</font><font color="maroon">0</font>; i<font color="black">&#60;</font>s.size<font color="black">(</font><font color="black">)</font>; <font color="black">)</font><font color="black">{</font>                                 \
            <font color="blue">if</font><font color="black">(</font> isspace<font color="black">(</font>s.at<font color="black">(</font>i<font color="black">)</font><font color="black">)</font> <font color="black">)</font><font color="black">{</font>                                 \
                s.erase<font color="black">(</font>i,<font color="maroon">1</font><font color="black">)</font>;                                       \
            <font color="black">}</font>                                                       \
            <font color="blue">else</font> i<font color="black">+</font><font color="black">+</font>;                                               \
        <font color="black">}</font>                                                           \
        <font color="blue">return</font> s;                                                   \
    <font color="black">}</font>

<font color="green">/** 
 * Create a bean without parameter
 * @param bean The bean name, it is user's class name
 * @return NULL if failed
*/</font>
<font color="blue">#define</font> AUTUMNBEAN_CONSTRUCTOR<font color="black">(</font>bean<font color="black">)</font>                                \
    <font color="blue">void</font><font color="black">*</font> createBean<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                             \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean <font color="black">=</font> NULL;                                         \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean <font color="black">=</font> <font color="blue">new</font> bean<font color="black">(</font><font color="black">)</font>;                                   \
        <font color="blue">return</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean;                                         \
    <font color="black">}</font>

<font color="green">/** 
 * Create a bean with parameters
 * This is the first part of creating function.
 * @param bean The bean name, it is user's class name
 * @param param_num The number of constructor's parameters
 * @param type The first parameter's type
 * @return NULL if failed
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_CON_PARAMS<font color="black">(</font>bean, param_num, type<font color="black">)</font>                \
    <font color="blue">void</font><font color="black">*</font> createBean<font color="black">(</font><font color="blue">void</font><font color="black">*</font><font color="black">*</font> pPrams, <font color="blue">int</font> num<font color="black">)</font><font color="black">{</font>                       \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean <font color="black">=</font> NULL;                                         \
        <font color="blue">if</font><font color="black">(</font> num <font color="black">!</font><font color="black">=</font> param_num<font color="black">)</font><font color="black">{</font>                                      \
            <font color="blue">return</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean;                                     \
        <font color="black">}</font>                                                           \
                                                                    \
        <font color="blue">int</font> i <font color="black">=</font> num;                                                \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean <font color="black">=</font> <font color="blue">new</font> bean<font color="black">(</font>                                     \
            <font color="black">*</font><font color="black">(</font>type<font color="black">*</font><font color="black">)</font>pPrams<font color="black">[</font><font color="black">-</font><font color="black">-</font>i<font color="black">]</font>

<font color="green">/** 
 * Add the next parameter for constructor
 * @param type The parameter's type
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_CON_PARAM<font color="black">(</font>type<font color="black">)</font>                                  \
            ,<font color="black">*</font><font color="black">(</font>type<font color="black">*</font><font color="black">)</font>pPrams<font color="black">[</font><font color="black">-</font><font color="black">-</font>i<font color="black">]</font>

<font color="green">/** 
 * End of the parameter list and end of creating function
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_CON_PARAMS_END<font color="black">(</font><font color="black">)</font>                                 \
            <font color="black">)</font>;                                                      \
                                                                    \
        <font color="blue">return</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean;                                         \
    <font color="black">}</font>
    
<font color="green">/** 
 * Initializing function
 * @param init The class's initializing function
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_INIT<font color="black">(</font>init<font color="black">)</font>                                       \
    <font color="blue">void</font> initializeBean<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                          \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean<font color="black">-</font><font color="black">&#62;</font>init<font color="black">(</font><font color="black">)</font>;                                        \
    <font color="black">}</font>
    
<font color="green">/** 
 * Initializing function
 * @param init The class's destroying function
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_DESTROY<font color="black">(</font>destroy<font color="black">)</font>                                 \
    <font color="blue">void</font> destroyBean<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                             \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean<font color="black">-</font><font color="black">&#62;</font>destroy<font color="black">(</font><font color="black">)</font>;                                     \
    <font color="black">}</font>
    
<font color="green">/** 
 * bean's setter, the first part
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_SETTER<font color="black">(</font><font color="black">)</font>                                         \
    <font color="blue">int</font> setBeanProperty<font color="black">(</font><font color="blue">const</font> <font color="blue">char</font><font color="black">*</font> <font color="blue">name</font>,                           \
            <font color="blue">const</font> <font color="blue">char</font><font color="black">*</font> type, <font color="blue">void</font><font color="black">*</font> value<font color="black">)</font><font color="black">{</font>

<font color="green">/** 
 * Add property
 * @param pname Property's name
 * @param ptype Property's type
 * @return 0 for success and -1 for failure
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_PROPERTY<font color="black">(</font>pname, ptype<font color="black">)</font>                           \
        <font color="blue">if</font><font color="black">(</font><font color="black">!</font>strcmp<font color="black">(</font>#pname, <font color="blue">name</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font>                                 \
                <font color="black">!</font><font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>trimString<font color="black">(</font>#ptype<font color="black">)</font>.compare<font color="black">(</font>type<font color="black">)</font><font color="black">)</font><font color="black">{</font>           \
            <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pBean<font color="black">-</font><font color="black">&#62;</font>set##pname<font color="black">(</font><font color="black">*</font><font color="black">(</font>ptype<font color="black">*</font><font color="black">)</font>value<font color="black">)</font>;                \
        <font color="black">}</font>                                                           \
        <font color="blue">else</font> 
<font color="green">/** 
 * the last part of bean's setter
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_SETTER_END<font color="black">(</font><font color="black">)</font>                                     \
            <font color="blue">return</font> <font color="maroon">-1</font>;                                              \
        <font color="blue">return</font> <font color="maroon">0</font>;                                                   \
    <font color="black">}</font>
    
<font color="green">/** 
 * the last part of bean adapter,
 * the creating function of bean adapter
 * @param bean The bean name, it is user's class name
 */</font>
<font color="blue">#define</font> AUTUMNBEAN_END<font color="black">(</font>bean<font color="black">)</font>                                        \
<font color="black">}</font>;                                                                  \
                                                                    \
<font color="blue">extern</font> <font color="maroon">"C"</font><font color="black">{</font>                                                         \
    DLL_EXPORT IBeanWrapper<font color="black">*</font> create_##bean##_Wrapper<font color="black">(</font><font color="black">)</font>;             \
    DLL_EXPORT <font color="blue">void</font> delete_##bean##_Wrapper<font color="black">(</font>IBeanWrapper<font color="black">*</font><font color="black">)</font>;         \
    IBeanWrapper<font color="black">*</font> create_##bean##_Wrapper<font color="black">(</font><font color="black">)</font><font color="black">{</font>                        \
        <font color="blue">return</font> <font color="blue">new</font> bean##_Wrapper;                                  \
    <font color="black">}</font>                                                               \
    <font color="blue">void</font> delete_##bean##_Wrapper<font color="black">(</font>IBeanWrapper<font color="black">*</font> p<font color="black">)</font><font color="black">{</font>                  \
        <font color="blue">delete</font> p;                                                   \
    <font color="black">}</font>                                                               \
<font color="black">}</font>

<font color="green">/** 
 * Register creating function to local bean factory
 * @param bean The bean name, it is user's class name
 */</font>
<font color="blue">#define</font> AUTUMN_LOCALBEAN<font color="black">(</font>bean<font color="black">)</font>                                      \
                                                                    \
<font color="blue">class</font> AUTUMN_##bean##_Proxy<font color="black">{</font>                                        \
<font color="blue">private</font><font color="black">:</font>                                                            \
    string mangleName<font color="black">(</font>string op, string objName<font color="black">)</font><font color="black">{</font>                   \
        <font color="blue">if</font><font color="black">(</font> op <font color="black">=</font><font color="black">=</font> <font color="maroon">"create"</font> <font color="black">)</font>                                        \
            <font color="blue">return</font> <font color="maroon">"create_"</font> <font color="black">+</font> objName <font color="black">+</font> <font color="maroon">"_Wrapper"</font>;                \
        <font color="blue">else</font> <font color="blue">if</font><font color="black">(</font> op <font color="black">=</font><font color="black">=</font> <font color="maroon">"delete"</font> <font color="black">)</font>                                   \
            <font color="blue">return</font> <font color="maroon">"delete_"</font> <font color="black">+</font> objName <font color="black">+</font> <font color="maroon">"_Wrapper"</font>;                \
        <font color="blue">else</font> <font color="blue">return</font> string<font color="black">(</font><font color="maroon">""</font><font color="black">)</font>;                                     \
    <font color="black">}</font>                                                               \
                                                                    \
<font color="blue">public</font><font color="black">:</font>                                                             \
    AUTUMN_##bean##_Proxy<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                        \
        registerLocalFunction<font color="black">(</font>                                      \
                <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>mangleName<font color="black">(</font><font color="maroon">"create"</font>, #bean<font color="black">)</font>.c_str<font color="black">(</font><font color="black">)</font>,          \
                <font color="black">(</font><font color="blue">void</font><font color="black">*</font><font color="black">)</font>create_##bean##_Wrapper<font color="black">)</font>;                    \
        registerLocalFunction<font color="black">(</font>                                      \
                <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>mangleName<font color="black">(</font><font color="maroon">"delete"</font>, #bean<font color="black">)</font>.c_str<font color="black">(</font><font color="black">)</font>,          \
                <font color="black">(</font><font color="blue">void</font><font color="black">*</font><font color="black">)</font>delete_##bean##_Wrapper<font color="black">)</font>;                    \
    <font color="black">}</font>                                                               \
<font color="black">}</font>;                                                                  \
                                                                    \
AUTUMN_##bean##_Proxy _AUTUMN_##bean##_Proxy_;

<font color="green">/** 
 * Define a customized type wrapper, like bean wrapper
 * @param type the class devided from IBasicType or ICombinedType
 */</font>
<font color="blue">#define</font> AUTUMNTYPE<font color="black">(</font>type<font color="black">)</font>                                            \
<font color="blue">class</font> type##_Type<font color="black">:</font><font color="blue">public</font> IBeanWrapper<font color="black">{</font>                              \
    type <font color="black">*</font> pType;                                                   \
                                                                    \
<font color="blue">public</font><font color="black">:</font>                                                             \
    type##_Type<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                                  \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>setBeanName<font color="black">(</font>#type<font color="black">)</font>;                                   \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pType <font color="black">=</font> NULL;                                         \
    <font color="black">}</font>                                                               \
    <font color="blue">void</font><font color="black">*</font> createBean<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                             \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pType <font color="black">=</font> NULL;                                         \
        <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pType <font color="black">=</font> <font color="blue">new</font> type<font color="black">(</font><font color="black">)</font>;                                   \
        <font color="blue">return</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pType;                                         \
    <font color="black">}</font>                                                               \
    ~##type##_Type<font color="black">(</font><font color="black">)</font><font color="black">{</font>                                               \
        <font color="blue">if</font><font color="black">(</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pType <font color="black">)</font>                                           \
            <font color="blue">delete</font> <font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pType;                                     \
    <font color="black">}</font>                                                               \
    <font color="blue">void</font><font color="black">*</font> getBean<font color="black">(</font><font color="black">)</font><font color="black">{</font> <font color="blue">return</font> <font color="black">(</font><font color="blue">void</font><font color="black">*</font><font color="black">)</font><font color="blue">this</font><font color="black">-</font><font color="black">&#62;</font>pType; <font color="black">}</font>                   \
<font color="black">}</font>;                                                                  \
                                                                    \
<font color="blue">extern</font> <font color="maroon">"C"</font><font color="black">{</font>                                                         \
    DLL_EXPORT IBeanWrapper<font color="black">*</font> create_##type##_Type<font color="black">(</font><font color="black">)</font>;                \
    DLL_EXPORT <font color="blue">void</font> delete_##type##_Type<font color="black">(</font>IBeanWrapper<font color="black">*</font><font color="black">)</font>;            \
    IBeanWrapper<font color="black">*</font> create_##type##_Type<font color="black">(</font><font color="black">)</font><font color="black">{</font>                           \
        <font color="blue">return</font> <font color="blue">new</font> type##_Type;                                     \
    <font color="black">}</font>                                                               \
    <font color="blue">void</font> delete_##type##_Type<font color="black">(</font>IBeanWrapper<font color="black">*</font> p<font color="black">)</font><font color="black">{</font>                     \
        <font color="blue">delete</font> p;                                                   \
    <font color="black">}</font>                                                               \
<font color="black">}</font>

<font color="blue">#endif</font>

</PRE>
</BODY>
</HTML>
